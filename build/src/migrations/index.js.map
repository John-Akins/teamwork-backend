{"version":3,"sources":["../../../src/migrations/index.js"],"names":["dbMigration","tableExists","table","Promise","resolve","reject","query","db","then","error","tablesAndQueries","hasCreatedTables","createTablesIfNotExists","i","tableQuery","res","length","dummyQueries","dummyQueriesExecuted","fillDummyData","len","response"],"mappings":"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","sourcesContent":["import db from \"../db\"\r\n\r\nconst dbMigration = {}\r\n\r\ndbMigration.tableExists = (table) => {\r\n    return new Promise((resolve, reject) => {\r\n        const query = `SELECT * FROM ${table}`\r\n        db.query(query)\r\n        .then(() => {\r\n            resolve(true)\r\n        })\r\n        .catch((error) => {\r\n            reject(false)\r\n        })\r\n    })\r\n}\r\n\r\ndbMigration.tablesAndQueries = [\r\n    {\r\n        table: \"users\", \r\n        query: 'CREATE TABLE users ( \"userId\" bigint NOT NULL, \"firstName\" character varying(30) NOT NULL, \"lastName\" character varying NOT NULL, email character varying NOT NULL, address character varying NOT NULL, password character varying NOT NULL, gender character varying NOT NULL, \"jobRole\" character varying NOT NULL, department character varying NOT NULL, \"isAdmin\" boolean NOT NULL, \"isNewAccount\" boolean DEFAULT true NOT NULL )'\r\n    },\r\n\r\n    {\r\n        table: \"articles\",\r\n        query: 'CREATE TABLE articles ( title character(100) NOT NULL, \"articleId\" bigint NOT NULL, \"createdOn\" date NOT NULL, \"createdBy\" character varying(20) NOT NULL, article character(1000) NOT NULL )'\r\n    },\r\n\r\n    {\r\n        table: \"feedComments\",\r\n        query: 'CREATE TABLE feedComments ( \"feedId\" bigint NOT NULL, \"commentId\" bigint NOT NULL, \"feedType\" character(20) NOT NULL, comment character(500) NOT NULL, \"commentOn\" date NOT NULL, \"commentBy\" bigint NOT NULL, \"isFlagged\" boolean )'\r\n    },\r\n\r\n    {\r\n        table: \"feedFlags\",\r\n        query: 'CREATE TABLE feedFlags ( \"flagId\" bigint NOT NULL, \"feedId\" bigint NOT NULL, \"feedType\" character(20) NOT NULL, \"flaggedOn\" date, \"flaggedBy\" character(20) )'\r\n    },\r\n\r\n    {\r\n        table: \"gifs\",\r\n        query: 'CREATE TABLE gifs ( \"gifId\" bigint NOT NULL, title character(100) NOT NULL, \"imageUrl\" character(100) NOT NULL, \"createdOn\" date NOT NULL, \"createdBy\" character(20)[] NOT NULL )'\r\n    }\r\n]\r\n\r\ndbMigration.hasCreatedTables = false\r\n\r\ndbMigration.createTablesIfNotExists = () => {\r\n        const tablesAndQueries = dbMigration.tablesAndQueries\r\n        for (let i = 0; i < tablesAndQueries.length; i++) \r\n        {\r\n            dbMigration.hasCreatedTables = (i === 0) ? true : dbMigration.hasCreatedTables\r\n            const table = tablesAndQueries[i].table\r\n            const tableQuery = tablesAndQueries[i].query\r\n            // check if table exists\r\n            dbMigration.tableExists(table)\r\n            .then(res => {\r\n                dbMigration.hasCreatedTables = dbMigration.hasCreatedTables && res\r\n            })\r\n            .catch(error => {\r\n                db.query(tableQuery)\r\n                .then(() => {\r\n                    dbMigration.hasCreatedTables = dbMigration.hasCreatedTables && true\r\n                })\r\n                .catch( () => {\r\n                    dbMigration.hasCreatedTables = dbMigration.hasCreatedTables && error\r\n                })\r\n            })\r\n        }\r\n        return dbMigration.hasCreatedTables\r\n}\r\n\r\ndbMigration.dummyQueries = [\r\n\r\n    {\r\n        table: \"articles\",\r\n        query: \"INSERT INTO articles (title, articleId, createdOn, createdBy, article) values ('Old lady tale', 10001, '2019-10-12', 10001, 'One nice Old Lady Tale '),('Quick brown fox', 10002, '2019-11-12',10002, 'One Hell of a quick brown fox'), ('Ada Lovelace', 10003, '2019-10-12',\t10002, 'A computer science fairy tale')\"\r\n    },\r\n    {\r\n        table: \"feedComments\",\r\n        query:\"INSERT INTO  feedComments (feedId, commentId, feedType, comment, commentOn, commentBy, isFlagged) values (10001, 10001,'article', 'Very nice', '2019-10-10', 10001, f), (10002, 10002,\t'article', 'Very nice', '2019-10-10', 10001, f)\"\r\n    },\r\n    {\r\n        table: \"users\",\r\n        query: \"INSERT INTO  users (userId, firstName, lastName, email, address, password, gender, jobRole, department, isAdmin, isNewAccount) values (10001, 'Ada Lovelace', 'lovelace@gmail.com', 'LOvelace street', '$2b$10$dTlK9RWsDFxj0jvAARftqeonxRuBVTQVKpsbvk9tt.MsFcjnTjpxa', 'female',\t'Software Engineer', 'IT',\tt,\tf), (10002,\t'Ada Turan', 'turan@gmail.com', 'Turan street', '$2b$10$dTlK9RWsDFxj0jvAARftqeonxRuBVTQVKpsbvk9tt.MsFcjnTjpxa',\t'male',\t'Software Engineer', 'IT',\tf,\tf)\"\r\n    }\r\n\r\n]\r\n\r\ndbMigration.dummyQueriesExecuted = false\r\n\r\ndbMigration.fillDummyData = () => {\r\n    const dummyQueries = dbMigration.dummyQueries\r\n    const len = dummyQueries.length\r\n    for (let i = 0; i < len; i++) {\r\n        dbMigration.hasCreatedTables = (i === 0) ? true : dbMigration.hasCreatedTables\r\n        db.query(dummyQueries[i])\r\n        .then((response) => {\r\n            dbMigration.hasCreatedTables = dbMigration.hasCreatedTables && true            \r\n        })\r\n        .catch((error) => {\r\n            dbMigration.hasCreatedTables = dbMigration.hasCreatedTables && false\r\n        })\r\n    }\r\n    return dbMigration.hasCreatedTables;\r\n}\r\n\r\nexport default dbMigration"],"file":"index.js"}